<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafeLink - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Å—Å—ã–ª–∫–µ (DEBUG)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
        }

        .warning-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
        }

        .warning-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .warning-title {
            font-size: 28px;
            color: #e74c3c;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .url-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: monospace;
            word-break: break-all;
            color: #e74c3c;
            border: 2px solid #e74c3c;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }

        .countdown {
            font-weight: bold;
            color: #e74c3c;
        }

        .debug-info {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 12px;
            text-align: left;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="warning-container">
        <div class="warning-icon">‚ö†Ô∏è</div>
        
        <h1 class="warning-title">–í–ù–ò–ú–ê–ù–ò–ï! –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω–∞—è —Å—Å—ã–ª–∫–∞</h1>
        
        <p style="margin-bottom: 20px;">SafeLink –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π —Å–∞–π—Ç:</p>
        
        <div class="url-display" id="dangerUrl">
            –ó–∞–≥—Ä—É–∑–∫–∞ URL...
        </div>

        <div class="debug-info" id="debugLog">
            –õ–æ–≥ –æ—Ç–ª–∞–¥–∫–∏:
        </div>

        <div class="action-buttons">
            <button class="btn btn-primary" id="goBackBtn">
                ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥
            </button>
            
            <button class="btn btn-secondary" id="allowSiteBtn">
                –†–∞–∑—Ä–µ—à–∏—Ç—å —Å–∞–π—Ç
            </button>
            
            <button class="btn btn-danger" id="continueBtn">
                –í—Å—ë —Ä–∞–≤–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ (<span class="countdown" id="countdown">10</span>)
            </button>
        </div>

        <div style="margin-top: 30px; color: #666; font-size: 14px;">
            <p><strong>üß™ –û–¢–õ–ê–î–û–ß–ù–ê–Ø –í–ï–†–°–ò–Ø</strong></p>
            <p>–≠—Ç–∞ –≤–µ—Ä—Å–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º</p>
        </div>
    </div>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –ª–æ–≥
        function addToLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            const debugLog = document.getElementById('debugLog');
            if (debugLog) {
                debugLog.textContent += logEntry;
                debugLog.scrollTop = debugLog.scrollHeight;
            }
            console.log(`SafeLink Debug: ${message}`);
        }

        // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –≤–µ—Ä—Å–∏—è WarningPage
        class WarningPageDebug {
            constructor() {
                this.targetUrl = null;
                this.countdown = 10;
                this.countdownInterval = null;
                this.contextInvalidatedShown = false;
                
                addToLog('üöÄ WarningPageDebug –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                this.init();
            }

            init() {
                addToLog('üìã –ù–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é...');
                this.parseUrl();
                this.loadStats();
                this.setupEventListeners();
                this.startCountdown();
                addToLog('‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
            }

            parseUrl() {
                const urlParams = new URLSearchParams(window.location.search);
                this.targetUrl = urlParams.get('url');
                
                addToLog(`üîç URL –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤: ${this.targetUrl}`);
                
                if (this.targetUrl) {
                    document.getElementById('dangerUrl').textContent = this.targetUrl;
                    addToLog('‚úÖ URL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤');
                } else {
                    this.targetUrl = 'https://malware-site.com/debug-test';
                    document.getElementById('dangerUrl').textContent = this.targetUrl + ' (—Ç–µ—Å—Ç–æ–≤—ã–π URL)';
                    addToLog('‚ö†Ô∏è URL –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ—Å—Ç–æ–≤—ã–π');
                }
            }

            async loadStats() {
                addToLog('üìä –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É...');
                try {
                    if (typeof chrome !== 'undefined' && chrome.storage) {
                        const result = await chrome.storage.local.get(['safelink_stats']);
                        addToLog('‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                    } else {
                        addToLog('‚ö†Ô∏è Chrome storage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                    }
                } catch (error) {
                    addToLog(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: ${error.message}`);
                }
            }

            setupEventListeners() {
                addToLog('üîß –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π...');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                const goBackBtn = document.getElementById('goBackBtn');
                const allowSiteBtn = document.getElementById('allowSiteBtn');
                const continueBtn = document.getElementById('continueBtn');
                
                addToLog(`üîç –≠–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã: goBack=${!!goBackBtn}, allowSite=${!!allowSiteBtn}, continue=${!!continueBtn}`);

                if (goBackBtn) {
                    goBackBtn.addEventListener('click', () => {
                        addToLog('üëÜ –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ "–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥"');
                        this.goBack();
                    });
                    addToLog('‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ goBackBtn –Ω–∞—Å—Ç—Ä–æ–µ–Ω');
                } else {
                    addToLog('‚ùå –≠–ª–µ–º–µ–Ω—Ç goBackBtn –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                }

                if (allowSiteBtn) {
                    allowSiteBtn.addEventListener('click', () => {
                        addToLog('üëÜ –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ "–†–∞–∑—Ä–µ—à–∏—Ç—å —Å–∞–π—Ç"');
                        this.allowSite();
                    });
                    addToLog('‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ allowSiteBtn –Ω–∞—Å—Ç—Ä–æ–µ–Ω');
                } else {
                    addToLog('‚ùå –≠–ª–µ–º–µ–Ω—Ç allowSiteBtn –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                }

                if (continueBtn) {
                    continueBtn.addEventListener('click', () => {
                        addToLog('üëÜ –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ "–í—Å—ë —Ä–∞–≤–Ω–æ –ø–µ—Ä–µ–π—Ç–∏"');
                        this.continueTo();
                    });
                    addToLog('‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ continueBtn –Ω–∞—Å—Ç—Ä–æ–µ–Ω');
                } else {
                    addToLog('‚ùå –≠–ª–µ–º–µ–Ω—Ç continueBtn –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                }

                // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        addToLog('‚å®Ô∏è –ù–∞–∂–∞—Ç–∞ –∫–ª–∞–≤–∏—à–∞ Escape');
                        this.goBack();
                    }
                });
                addToLog('‚å®Ô∏è –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã');
            }

            startCountdown() {
                const countdownElement = document.getElementById('countdown');
                const continueBtn = document.getElementById('continueBtn');
                
                if (!countdownElement || !continueBtn) {
                    addToLog('‚ùå –≠–ª–µ–º–µ–Ω—Ç—ã countdown –∏–ª–∏ continueBtn –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                    return;
                }
                
                continueBtn.disabled = true;
                addToLog(`‚è∞ –ù–∞—á–∞—Ç –æ–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á–µ—Ç: ${this.countdown} —Å–µ–∫—É–Ω–¥`);
                
                this.countdownInterval = setInterval(() => {
                    this.countdown--;
                    countdownElement.textContent = this.countdown;
                    addToLog(`‚è∞ –û–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á–µ—Ç: ${this.countdown}`);
                    
                    if (this.countdown <= 0) {
                        clearInterval(this.countdownInterval);
                        continueBtn.disabled = false;
                        continueBtn.innerHTML = '–í—Å—ë —Ä–∞–≤–Ω–æ –ø–µ—Ä–µ–π—Ç–∏';
                        addToLog('‚úÖ –û–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω, –∫–Ω–æ–ø–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
                    }
                }, 1000);
            }

            goBack() {
                addToLog('üîô –í—ã–ø–æ–ª–Ω—è–µ–º –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞–∑–∞–¥');
                try {
                    window.history.back();
                    addToLog('‚úÖ window.history.back() –≤—ã–ø–æ–ª–Ω–µ–Ω');
                } catch (error) {
                    addToLog(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ: ${error.message}`);
                    // Fallback - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
                    window.location.href = 'https://www.google.com';
                }
            }

            async allowSite() {
                addToLog('‚úÖ –†–∞–∑—Ä–µ—à–∞–µ–º —Å–∞–π—Ç');
                if (!this.targetUrl) {
                    addToLog('‚ùå targetUrl –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
                    return;
                }

                try {
                    if (typeof chrome !== 'undefined' && chrome.runtime) {
                        await chrome.runtime.sendMessage({
                            action: 'allowSite',
                            url: this.targetUrl
                        });
                        addToLog('‚úÖ –°–∞–π—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏—Å–∫–ª—é—á–µ–Ω–∏—è');
                    } else {
                        addToLog('‚ö†Ô∏è Chrome runtime –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                    }

                    // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å–∞–π—Ç
                    addToLog(`üîó –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞: ${this.targetUrl}`);
                    window.location.href = this.targetUrl;
                } catch (error) {
                    addToLog(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–∏ —Å–∞–π—Ç–∞: ${error.message}`);
                }
            }

            async continueTo() {
                addToLog(`üöÄ –ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞: ${this.targetUrl}`);
                
                if (!this.targetUrl) {
                    addToLog('‚ùå targetUrl –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!');
                    alert('–û—à–∏–±–∫–∞: URL –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    return;
                }

                try {
                    // –ï—Å–ª–∏ —ç—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π URL, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
                    if (this.targetUrl.includes('malware-site.com') || this.targetUrl.includes('debug-test')) {
                        const proceed = confirm(
                            '–≠—Ç–æ –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –≤–µ—Ä—Å–∏—è.\n\n' +
                            `URL –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è: ${this.targetUrl}\n\n` +
                            '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å? (–±—É–¥–µ—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ Google)'
                        );
                        
                        if (!proceed) {
                            addToLog('üö´ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª –ø–µ—Ä–µ—Ö–æ–¥');
                            return;
                        }
                        
                        addToLog('üîó –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ Google (–±–µ–∑–æ–ø–∞—Å–Ω–æ)');
                        window.location.href = 'https://www.google.com/search?q=SafeLink+debug+test+completed';
                        return;
                    }

                    // –û–±—ã—á–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥
                    addToLog(`üîó –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞: ${this.targetUrl}`);
                    window.location.href = this.targetUrl;
                } catch (error) {
                    addToLog(`‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞: ${error.message}`);
                    window.location.href = this.targetUrl;
                }
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        document.addEventListener('DOMContentLoaded', () => {
            addToLog('üåü DOM –∑–∞–≥—Ä—É–∂–µ–Ω, —Å–æ–∑–¥–∞–µ–º WarningPageDebug');
            window.warningPageDebug = new WarningPageDebug();
        });

        // –û—Ç–ª–∞–≤–ª–∏–≤–∞–µ–º –æ—à–∏–±–∫–∏ JavaScript
        window.addEventListener('error', (event) => {
            addToLog(`üí• JavaScript –æ—à–∏–±–∫–∞: ${event.error.message}`);
            console.error('JavaScript error:', event.error);
        });

        addToLog('üìÑ –°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–µ–Ω');
    </script>
</body>
</html> 